var Model=new(require("model/index")),Moment=require("vendor/moment");Moment.locale("de");var АктйонБар=require("com.alcoapps.actionbarextras");module.exports=function(){function e(){var e=Model.list();if(console.log(e),0!=e.length){var i=e.map(function(e){console.log(e.summary);var t=Ti.UI.createTableViewRow({height:Ti.UI.SIZE,itemId:JSON.stringify(e)});return t.add(Ti.UI.createLabel({color:"#6f7",text:e.title,height:Ti.UI.SIZE,font:{fontWeight:"bold",fontSize:20},top:10,left:10})),t.add(Ti.UI.createLabel({color:"#eee",text:Moment(e.ctime).format("LLLL"),height:Ti.UI.SIZE,font:{fontSize:16},top:40,left:10})),t.add(Ti.UI.createLabel({color:"#eee",text:"Individuen: "+e.summary.total+",  Arten: "+e.summary.species,height:Ti.UI.SIZE,font:{fontSize:16},top:60,left:10})),t});t.list.setData(i)}}var t=Ti.UI.createWindow({title:"Zählverwaltung"});return t.list=Ti.UI.createTableView({top:0,bottom:0,height:Ti.UI.FILL}),t.list.addEventListener("click",function(e){var t=JSON.parse(e.row.itemId),i=Ti.UI.createEmailDialog();i.subject="Amphibienzählung",i.toRecipients=["info@nabu.de"];var r=Object.getOwnPropertyNames(t.result).map(function(e){return console.log(e),e+": "+t.result[e]});i.messageBody="Zeit: "+Moment(t.ctime).format("LLLL")+" Uhr,\nOrt: "+t.title+"\nZählergebnisse:\n===============\n\n"+r.join("\n"),i.open()}),t.addEventListener("open",function(i){АктйонБар.title="Froschzähler",АктйонБар.subtitle="Verwaltung der Zählgruppen",t.add(t.list),i.source.getActivity().actionBar.displayHomeAsUp=!0;var r=i.source.getActivity();r.actionBar.onHomeIconItemSelected=function(){i.source.close()},r.onCreateOptionsMenu=function(t){t.menu.clear(),t.menu.add({title:"Add",itemId:1,icon:Ti.App.Android.R.drawable.ic_action_add,showAsAction:Ti.Android.SHOW_AS_ACTION_IF_ROOM}).addEventListener("click",function(){require("ui/project.dialog")(function(t){Model.add({title:t}),e()})})},r.invalidateOptionsMenu(),r.actionBar.onHomeIconItemSelected=function(){i.source.close()}}),e(),t};
module.exports=function(){function e(){return Ti.Android?Math.ceil(1e3*c.duration):Math.ceil(c.duration)}function t(e){e=Math.floor(e);var t=Math.floor(e/60),o=e-60*t;return i(t,2)+":"+i(o,2)}function i(e,t,i){return Array(t-String(e).length+1).join(i||"0")+e}function o(){l=t(e()/1e3)}function n(e){e||(e=c.time),s.timer.text=t(Math.round(e)/1e3)+" / "+l}function r(){f||(d=setInterval(function(){var e=Math.round(c.time);s.scrubBar.value=e,s.timer.text=t(e/1e3)+" / "+l},500)),f=!0}function a(){clearInterval(d),f=!1}var c,s=Ti.UI.createView({width:"260dp",height:"100dp"});s.timer=Ti.UI.createLabel({top:"10dp",right:0,width:Ti.UI.SIZE}),s.playStopBtn=Ti.UI.createButton({textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,backgroundColor:"transparent",font:{fontSize:"24dp",fontFamily:"FontAwesome"},color:"#000",top:0,width:Ti.UI.SIZE,height:Ti.UI.SIZE}),s.scrubBar=Ti.UI.createSlider({top:"40dp",width:"260dp",height:"30dp",min:0,max:100,value:0,style:Ti.Android?void 0:Titanium.UI.iPhone.ProgressBarStyle.PLAIN}),s.add(s.timer),s.add(s.playStopBtn),s.add(s.scrubBar);arguments[0]||{};Ti.App.idleTimerDisabled=!0;var d,l,u,p=Ti.App.idleTimerDisabled,c=Ti.Media.createSound(),m=!1,g=!1,f=!1;return s.scrubBar.show(),s.scrubBar.addEventListener("touchstart",function(e){m=!0,c.playing&&(g=!0,a(),c.pause())}),s.scrubBar.addEventListener("change",function(e){m&&n(e.value)}),s.scrubBar.addEventListener("touchend",function(e){c.setTime(s.scrubBar.value),c.paused&&g&&(c.play(),r()),m=!1,g=!1}),Ti.Android?c.addEventListener("change",function(e){Ti.API.debug("[AudioPlayerWidget] State: "+e.description+" ("+e.state+")"),e.state==Ti.Media.Sound.STATE_PLAYING?r():e.state==Ti.Media.Sound.STATE_PAUSED?a():e.state==Ti.Media.Sound.STATE_STOPPED&&a()}):(c.addEventListener("interrupted",function(e){a()}),c.addEventListener("resume",function(e){r()})),s.setUrl=function(e){c=Ti.Media.createSound({url:e,allowBackground:!0}),o(),n(),s.playStopBtn.title=u},s.dispose=function(){c.stop(),Ti.Android&&c.release(),Ti.App.idleTimerDisabled=p},s};
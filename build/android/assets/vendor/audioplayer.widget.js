var AF=require("vendor/awesomeicons");module.exports=function(){function e(){return Ti.Android?Math.ceil(1e3*u.duration):Math.ceil(u.duration)}function t(e){e=Math.floor(e);var t=Math.floor(e/60),o=e-60*t;return i(t,2)+":"+i(o,2)}function i(e,t,i){return Array(t-String(e).length+1).join(i||"0")+e}function o(){d=t(e()/1e3)}function r(e){e||(e=u.time),s.timer.text=t(Math.round(e)/1e3)+" / "+(d||"0")}function n(){g||(c=setInterval(function(){if(u&&u.time){var e=Math.round(u.time);s.scrubBar.value=e,s.timer.text=t(e/1e3)+" / "+d}},500),setTimeout(function(){clearInterval(c)},3e4)),g=!0}function a(){clearInterval(c),g=!1}var s=Ti.UI.createView({height:100,top:-100,backgroundColor:"#a090"});s.timer=Ti.UI.createLabel({top:10,right:20,width:Ti.UI.SIZE}),s.playStopBtn=Ti.UI.createButton({textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,backgroundColor:"transparent",font:{fontSize:30,fontFamily:"FontAwesome"},color:"#906f",top:0,title:AF.getIcon("play"),width:Ti.UI.SIZE,height:Ti.UI.SIZE}),s.scrubBar=Ti.UI.createSlider({top:"60dp",width:"80%",height:"30dp",min:0,max:100,value:0,style:Ti.Android?void 0:Titanium.UI.iPhone.ProgressBarStyle.PLAIN}),s.add(s.timer),s.add(s.playStopBtn),s.add(s.scrubBar);arguments[0]||{};Ti.App.idleTimerDisabled=!0;var c,d,l=Ti.App.idleTimerDisabled,u=Ti.Media.createSound(),p=!1,m=!1,g=!1;return s.scrubBar.show(),s.scrubBar.addEventListener("touchstart",function(e){p=!0,u.playing&&(m=!0,a(),u.pause())}),s.scrubBar.addEventListener("change",function(e){p&&r(e.value)}),s.scrubBar.addEventListener("touchend",function(e){u.setTime(s.scrubBar.value),u.paused&&m&&(u.play(),n()),p=!1,m=!1}),Ti.Android?u.addEventListener("change",function(e){Ti.API.debug("[AudioPlayerWidget] State: "+e.description+" ("+e.state+")"),e.state==Ti.Media.Sound.STATE_PLAYING?n():e.state==Ti.Media.Sound.STATE_PAUSED?a():e.state==Ti.Media.Sound.STATE_STOPPED&&(s.top.animate({top:-100}),a())}):(u.addEventListener("interrupted",function(e){a()}),u.addEventListener("resume",function(e){n()})),s.setUrl=function(e){u=Ti.Media.createSound({url:e,allowBackground:!0}),o(),r(),s.playStopBtn.title=AF.getIcon("pause"),u.play(),n()},s.dispose=function(){u.stop(),Ti.Android&&u.release(),Ti.App.idleTimerDisabled=l},s};
var AF=require("vendor/awesomeicons");module.exports=function(){function e(){return Ti.Android?Math.ceil(1e3*u.duration):Math.ceil(u.duration)}function t(e){e=Math.floor(e);var t=Math.floor(e/60),r=e-60*t;return i(t,2)+":"+i(r,2)}function i(e,t,i){return Array(t-String(e).length+1).join(i||"0")+e}function r(){l=t(e()/1e3)}function o(e){e||(e=u.time),c.timer.text=t(Math.round(e)/1e3)+" / "+(l||"0")}function n(){g||(s=setInterval(function(){if(u&&u.time){var e=Math.round(u.time);c.scrubBar.value=e,c.timer.text=t(e/1e3)+" / "+l}},500),setTimeout(function(){clearInterval(s)},3e4)),g=!0}function a(){clearInterval(s),g=!1}var c=Ti.UI.createView({height:100,top:-100,backgroundColor:"#a090"});c.timer=Ti.UI.createLabel({top:10,right:20,width:Ti.UI.SIZE}),c.playStopBtn=Ti.UI.createButton({textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,backgroundColor:"transparent",font:{fontSize:30,fontFamily:"FontAwesome"},color:"#906f",top:0,title:AF.getIcon("play"),width:Ti.UI.SIZE,height:Ti.UI.SIZE}),c.scrubBar=Ti.UI.createSlider({top:"60dp",width:"80%",height:"30dp",min:0,max:100,value:0,style:Ti.Android?void 0:Titanium.UI.iPhone.ProgressBarStyle.PLAIN}),c.add(c.timer),c.add(c.playStopBtn),c.add(c.scrubBar);arguments[0]||{};Ti.App.idleTimerDisabled=!0;var s,l,d=Ti.App.idleTimerDisabled,u=Ti.Media.createSound(),p=!1,m=!1,g=!1;return c.scrubBar.show(),c.scrubBar.addEventListener("touchstart",function(e){p=!0,u.playing&&(m=!0,a(),u.pause())}),c.scrubBar.addEventListener("change",function(e){p&&o(e.value)}),c.scrubBar.addEventListener("touchend",function(e){u.setTime(c.scrubBar.value),u.paused&&m&&(u.play(),n()),p=!1,m=!1}),Ti.Android?u.addEventListener("change",function(e){Ti.API.debug("[AudioPlayerWidget] State: "+e.description+" ("+e.state+")"),e.state==Ti.Media.Sound.STATE_PLAYING?n():e.state==Ti.Media.Sound.STATE_PAUSED?a():e.state==Ti.Media.Sound.STATE_STOPPED&&(c.top.animate({top:-100}),a())}):(u.addEventListener("interrupted",function(e){a()}),u.addEventListener("resume",function(e){n()})),c.setUrl=function(e){u=Ti.Media.createSound({url:e,allowBackground:!0}),r(),o(),c.playStopBtn.title=AF.getIcon("pause"),u.play(),n()},c.dispose=function(){u.stop(),Ti.Android&&u.release(),Ti.App.idleTimerDisabled=d},c};